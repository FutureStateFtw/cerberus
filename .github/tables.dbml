// Cerberus Database Schema

Table applications {
  id int [pk, increment]
  name text [not null, unique]
  description text
  created_at timestampz [not null, default: `NOW()`]
  updated_at timestampz [not null, default: `NOW()`]
  
  Indexes {
    name [unique]
  }
}

Table application_roles {
  id int [pk, increment]
  application_id int [not null]
  role text [not null]
  description text
  created_at timestampz [not null, default: `NOW()`]
  
  Indexes {
    (application_id, role) [unique]
  }
}

Table user_roles {
  id int [pk, increment]
  application_id int [not null]
  role_id int [not null]
  person_id text [not null]
  justification text [not null]
  added_by text [not null]
  added_at timestampz [not null, default: `NOW()`]
  
  Indexes {
    application_id
    person_id
    role_id
    (application_id, person_id, role_id) [unique]
  }
}

// Relationships
Ref: application_roles.application_id > applications.id [delete: cascade]
Ref: user_roles.application_id > applications.id [delete: cascade]
Ref: user_roles.role_id > application_roles.id [delete: cascade]

// Notes
/* Note applications {
  'Stores all applications managed by Cerberus.
  Application names must be unique across the system.
  When an application is created, three default roles are automatically created: user, admin, and authorizer.'
}

Note application_roles {
  'Stores roles available for each application.
  The combination of application_id and role must be unique.
  Default roles (user, admin, authorizer) are created automatically when an application is added.
  Roles should not be mutable (too risky), only deleted and created.'
}

Note user_roles {
  'Stores user role assignments for applications.
  Tracks who added the role, when, and why (justification).
  A person can have multiple roles for the same application.
  The combination of application_id, person_id, and role must be unique (prevents duplicate assignments).
  Only person_id is stored; full person details are retrieved from external directory.'
}
*/
